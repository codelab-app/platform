# Docker containers work on a merged networking stack, the second container should make it available in localhost
# https://discuss.circleci.com/t/whats-the-docker-hostname-for-the-second-container/20101
docker:
  # - image: mcr.microsoft.com/playwright:v1.50.0-noble
  - image: cimg/node:22.13.1-browsers
    # https://circleci.com/docs/configuration-reference/#docker
    name: 127.0.0.1
  # https://circleci.com/docs/using-docker#using-multiple-docker-images
  # The `command` key is the command issued to the image
  - image: neo4j:5.26.0-enterprise
    environment:
      NEO4J_ACCEPT_LICENSE_AGREEMENT: yes
      NEO4J_AUTH: neo4j/password
      NEO4J_PLUGINS: '["apoc"]'
      # Enable debug logging for container
      NEO4J_dbms_logs_debug_level: DEBUG
      NEO4J_dbms_logs_query_enabled: 'true'
      NEO4J_dbms_logs_query_threshold: '0'

      # This enables verbose console logging
      NEO4J_dbms_logs_to_console: 'true'
      # These are the recommended settings generated by `neo4j-admin`
      NEO4J_server_jvm_additional: -XX:+ExitOnOutOfMemoryError
      # NEO4J_server_memory_heap_initial__size: 3600m
      # NEO4J_server_memory_heap_max__size: 3600m
      # NEO4J_server_memory_pagecache_size: 4g
      # Was showing due to `max_old_space_size`, set manually instead
      # NEO4J_server_memory_heap_initial__size: 2g
      # NEO4J_server_memory_heap_max__size: 2g
      # NEO4J_server_memory_pagecache_size: 512m
