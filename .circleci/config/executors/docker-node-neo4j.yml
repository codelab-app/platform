# Docker containers work on a merged networking stack, the second container should make it available in localhost
# https://discuss.circleci.com/t/whats-the-docker-hostname-for-the-second-container/20101
docker:
  - image: node:22
    # https://circleci.com/docs/configuration-reference/#docker
    # name: 127.0.0.1
  # https://circleci.com/docs/using-docker#using-multiple-docker-images
  # The `command` key is the command issued to the image
  - image: neo4j:5.26.3-enterprise
    environment:
      NEO4J_ACCEPT_LICENSE_AGREEMENT: yes
      NEO4J_AUTH: neo4j/password
      NEO4J_PLUGINS: '["apoc"]'
      # Enable debug logging for container
      NEO4J_dbms_logs_debug_level: DEBUG
      # These are the recommended settings generated by `neo4j-admin`
      NEO4J_server_jvm_additional: -XX:+ExitOnOutOfMemoryError
      # NEO4J_server_memory_heap_initial__size: 3600m
      # NEO4J_server_memory_heap_max__size: 3600m
      # NEO4J_server_memory_pagecache_size: 4g
      # Was showing due to `max_old_space_size`, set manually instead
      # NEO4J_server_memory_heap_initial__size: 2g
      # NEO4J_server_memory_heap_max__size: 2g
      # NEO4J_server_memory_pagecache_size: 512m
  # - image: redis:7.0.10
  # Redis will also be available at 127.0.0.1:6379
